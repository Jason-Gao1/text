<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>å­¦æ•ˆå¼•æ“ Â· é«˜é¢‘é”™é¢˜è¿½è¸ªè¡¨ï¼ˆDemoï¼‰</title>
<style>
  :root{--bg1:#0b1b47; --bg2:#5b21b6; --card:#ffffff; --muted:#6b7280; --brand:#2563eb; --brand2:#7c3aed;}
  html,body{margin:0;padding:0;background:linear-gradient(135deg,var(--bg1),var(--bg2));font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue','PingFang SC','Noto Sans CJK SC','Microsoft YaHei',Arial;color:#101828}
  .wrap{max-width:1180px;margin:0 auto;padding:28px}
  .hero{color:#fff;display:flex;align-items:center;gap:12px;flex-wrap:wrap;margin:6px 0 8px}
  .logo{width:44px;height:44px;border-radius:12px;background:linear-gradient(135deg,#2563eb,#7c3aed);display:flex;align-items:center;justify-content:center;font-weight:800;color:#fff;box-shadow:0 6px 20px rgba(0,0,0,.25)}
  .title h1{margin:0;font-size:22px;letter-spacing:.5px}
  .title p{margin:4px 0 0 0;opacity:.9}
  .card{background:var(--card);border-radius:16px;padding:18px;margin-top:14px; box-shadow:0 10px 30px rgba(0,0,0,.10)}
  .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:12px}
  .col-3{grid-column:span 3} .col-4{grid-column:span 4} .col-6{grid-column:span 6} .col-8{grid-column:span 8} .col-12{grid-column:span 12}
  label{font-size:14px;color:#374151;margin-bottom:6px;display:block}
  input,select,textarea{width:100%;padding:11px 12px;border:1px solid #e5e7eb;border-radius:10px;font-size:14px;box-sizing:border-box;outline:none}
  textarea{min-height:56px;resize:vertical}
  .btn{appearance:none;border:0;border-radius:12px;padding:12px 16px;background:linear-gradient(135deg,var(--brand),var(--brand2));color:#fff;font-weight:700;cursor:pointer}
  .btn.secondary{background:#eef2ff;color:#4338ca}
  table{width:100%;border-collapse:separate;border-spacing:0 8px}
  th,td{background:#fff;padding:10px 12px;vertical-align:top}
  th{position:sticky;top:0;background:#f8fafc;font-weight:700;color:#334155}
  tr{border-radius:10px}
  .tools{display:flex;gap:10px;flex-wrap:wrap}
  .pill{display:inline-flex;align-items:center;gap:6px;background:#f1f5f9;border-radius:999px;padding:8px 12px;color:#0f172a}
  .footer{color:#c7d2fe;text-align:center;font-size:12px;margin:20px 0}
  .hint{font-size:12px;color:#6b7280;margin-top:6px}
  .tag{display:inline-block;background:#ecfeff;border:1px solid #06b6d4;color:#0e7490;border-radius:999px;padding:2px 8px;margin:1px;font-size:12px}
  .status{font-size:12px}
  .row{display:flex;gap:8px;flex-wrap:wrap}
  .row>*{flex:1 1 120px}
  @media (max-width:900px){ .col-3,.col-4,.col-6,.col-8{grid-column:span 12} .tools{justify-content:space-between} table{font-size:14px} }
</style>
</head>
<body>
<div class="wrap">
  <div class="hero">
    <div class="logo">é”™é¢˜</div>
    <div class="title">
      <h1>é«˜é¢‘é”™é¢˜è¿½è¸ªè¡¨ï¼ˆDemoï¼‰</h1>
      <p>è‡ªåŠ¨åˆ†ç±»é”™å› ã€å®‰æ’å›ç‚‰å¤ä¹ ï½œå­¦æ•ˆå¼•æ“</p>
    </div>
  </div>

  <div class="card">
    <div class="grid">
      <div class="col-3"><label>ç§‘ç›®</label>
        <input id="subject" placeholder="æ•°å­¦/è¡Œæµ‹/è‹±è¯­/ä¸“ä¸šè¯¾"/>
      </div>
      <div class="col-3"><label>ä¸“é¢˜</label>
        <input id="topic" placeholder="æé™/æ¦‚ç‡/èµ„æ–™åˆ†æ"/>
      </div>
      <div class="col-3"><label>é”™è¯¯ç±»å‹</label>
        <select id="errType">
          <option>æ¦‚å¿µæ··æ·†</option>
          <option>å®¡é¢˜å¤±è¯¯</option>
          <option>è®¡ç®—å¤±è¯¯</option>
          <option>ç²—å¿ƒå¤§æ„</option>
          <option>æ—¶é—´ä¸å¤Ÿ</option>
        </select>
      </div>
      <div class="col-3"><label>éš¾åº¦</label>
        <select id="level">
          <option>å®¹æ˜“</option>
          <option selected>ä¸­ç­‰</option>
          <option>å›°éš¾</option>
        </select>
      </div>

      <div class="col-6"><label>é¢˜å¹²/æˆªå›¾é“¾æ¥</label>
        <input id="qref" placeholder="å¯ç²˜è´´é¢˜å¹²æ‘˜è¦æˆ–å›¾åºŠé“¾æ¥"/>
      </div>
      <div class="col-6"><label>æ­£ç¡®æ€è·¯ï¼ˆç®€è¿°ï¼‰</label>
        <input id="solution" placeholder="è§£é¢˜å…³é”®æ­¥éª¤/å…¬å¼"/>
      </div>

      <div class="col-6"><label>é”™å› åˆ†æ</label>
        <textarea id="cause" placeholder="ä¸ºä»€ä¹ˆé”™ï¼Ÿé—æ¼æ¡ä»¶/è¯¯ç”¨å…¬å¼/æ¦‚å¿µä¸æ¸…/è¯»é¢˜åå·®ç­‰"></textarea>
      </div>
      <div class="col-6"><label>æ ‡ç­¾ï¼ˆé€—å·åˆ†éš”ï¼‰</label>
        <input id="tags" placeholder="å¦‚ï¼šæé™, æ´›å¿…è¾¾, ä¸å®šå¼"/>
      </div>

      <div class="col-4"><label>é¦–æ¬¡è®°å½•æ—¥æœŸ</label>
        <input id="firstDate" type="date" />
      </div>
      <div class="col-4"><label>å¤ä¹ é—´éš”æ–¹æ¡ˆ</label>
        <select id="preset">
          <option value="1,3,7,14,30">æ ‡å‡†ï¼š1,3,7,14,30</option>
          <option value="1,2,4,7,15,30">å¯†é›†ï¼š1,2,4,7,15,30</option>
          <option value="2,5,10,20,40">å®½æ¾ï¼š2,5,10,20,40</option>
        </select>
      </div>
      <div class="col-4"><label>çŠ¶æ€</label>
        <select id="status">
          <option>å¾…å¤ç›˜</option>
          <option selected>å­¦ä¹ ä¸­</option>
          <option>å·²æŒæ¡</option>
        </select>
      </div>

      <div class="col-12">
        <div class="row">
          <button class="btn" onclick="addItem()">æ·»åŠ é”™é¢˜</button>
          <button class="btn secondary" onclick="downloadCSV()">ä¸‹è½½CSV</button>
          <button class="btn secondary" onclick="window.print()">æ‰“å°/ä¿å­˜PDF</button>
          <button class="btn secondary" onclick="clearAll()">æ¸…ç©ºï¼ˆæœ¬åœ°ï¼‰</button>
        </div>
        <div class="hint">æ•°æ®å­˜å‚¨åœ¨ä½ çš„æµè§ˆå™¨æœ¬åœ°ï¼ˆlocalStorageï¼‰ï¼Œä¸è”ç½‘ï¼›å¦‚éœ€äº‘ç«¯åŒæ­¥ï¼Œå¯åç»­æ¥å…¥è´¦å·ç³»ç»Ÿã€‚</div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="tools">
      <div class="pill">ğŸ“Š æ¡ç›®æ•°ï¼š<span id="countOut">0</span></div>
      <div class="pill">ğŸ§© ä»Šæ—¥éœ€å¤ä¹ ï¼š<span id="dueOut">0</span></div>
      <div class="pill">ğŸ” ç­›é€‰ï¼š
        <select id="filterSubject" onchange="render()"><option value="">å…¨éƒ¨ç§‘ç›®</option></select>
        <select id="filterStatus" onchange="render()">
          <option value="">å…¨éƒ¨çŠ¶æ€</option>
          <option>å¾…å¤ç›˜</option><option>å­¦ä¹ ä¸­</option><option>å·²æŒæ¡</option>
        </select>
      </div>
    </div>
  </div>

  <div class="card">
    <h3>é”™é¢˜åˆ—è¡¨ï¼ˆæŒ‰â€œä¸‹æ¬¡å¤ä¹ æ—¥â€æ’åºï¼‰</h3>
    <div id="tableWrap"></div>
  </div>

  <div class="footer">Â© å­¦æ•ˆå¼•æ“ Â· Demo ä»…åšåŠŸèƒ½å±•ç¤ºï¼Œæ­£å¼ç‰ˆå°†æ¥å…¥AIåˆ¤å®šé”™å› ã€è‡ªåŠ¨æŠ½å–çŸ¥è¯†ç‚¹</div>
</div>

<script>
const KEY = 'xxyq_wrong_items_v1';

function todayStr(){ const d=new Date(); const y=d.getFullYear(), m=('0'+(d.getMonth()+1)).slice(-2), dd=('0'+d.getDate()).slice(-2); return `${y}-${m}-${dd}`; }
function addDays(ds, n){ const [y,m,d]=ds.split('-').map(Number); const dt=new Date(y, m-1, d); dt.setDate(dt.getDate()+n); const mm=('0'+(dt.getMonth()+1)).slice(-2), dd=('0'+dt.getDate()).slice(-2); return `${dt.getFullYear()}-${mm}-${dd}`; }

function getIntervals(){
  const p = document.getElementById('preset').value;
  return p.split(',').map(x=>+x);
}

function loadItems(){
  try{ return JSON.parse(localStorage.getItem(KEY)||'[]'); }catch(e){ return []; }
}
function saveItems(items){ localStorage.setItem(KEY, JSON.stringify(items)); }

function addItem(){
  const subject = document.getElementById('subject').value.trim();
  const topic   = document.getElementById('topic').value.trim();
  const errType = document.getElementById('errType').value;
  const level   = document.getElementById('level').value;
  const qref    = document.getElementById('qref').value.trim();
  const solution= document.getElementById('solution').value.trim();
  const cause   = document.getElementById('cause').value.trim();
  const tags    = document.getElementById('tags').value.replace(/ï¼Œ/g,',').split(',').map(s=>s.trim()).filter(Boolean);
  let firstDate = document.getElementById('firstDate').value || todayStr();
  const status  = document.getElementById('status').value;
  const intervals = getIntervals();

  if(!subject || !topic){ alert('è¯·å¡«å†™â€œç§‘ç›®â€å’Œâ€œä¸“é¢˜â€'); return; }

  const reviews = intervals.map((d,i)=> addDays(firstDate, d));
  const item = {id: Date.now(), subject, topic, errType, level, qref, solution, cause, tags, firstDate, status, intervals, reviews, nextReview: reviews[0]||firstDate, reviewIndex:0, done:false};
  const items = loadItems();
  items.push(item);
  saveItems(items);
  clearInputs();
  render();
}

function clearInputs(){
  ['subject','topic','qref','solution','cause','tags'].forEach(id=> document.getElementById(id).value='');
  document.getElementById('firstDate').value = '';
}

function clearAll(){
  if(confirm('ç¡®è®¤æ¸…ç©ºæœ¬åœ°æ‰€æœ‰é”™é¢˜è®°å½•ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤å›ã€‚')){
    localStorage.removeItem(KEY);
    render();
  }
}

function nextReviewBadge(item){
  const due = item.nextReview || '';
  const t = todayStr();
  let color = '#0ea5e9', text = 'è®¡åˆ’ä¸­';
  if(due === t){ color = '#16a34a'; text = 'ä»Šæ—¥å¤ä¹ '; }
  else if(due < t){ color = '#dc2626'; text = 'å·²é€¾æœŸ'; }
  return `<span class="status" style="color:${color}">${text}ï¼š${due||'-'}</span>`;
}

function doReview(id, mastered=false){
  const items = loadItems();
  const idx = items.findIndex(x=>x.id===id);
  if(idx<0) return;
  const it = items[idx];
  if(mastered){
    it.status = 'å·²æŒæ¡';
    it.done = true;
    it.nextReview = '';
  }else{
    const i = (it.reviewIndex||0) + 1;
    if(i >= it.intervals.length){
      it.status = 'å·²æŒæ¡';
      it.done = true;
      it.nextReview = '';
    }else{
      it.reviewIndex = i;
      it.nextReview = it.reviews[i];
      it.status = 'å­¦ä¹ ä¸­';
    }
  }
  items[idx] = it;
  saveItems(items);
  render();
}

function render(){
  const items = loadItems();
  const fs = document.getElementById('filterSubject').value;
  const fst = document.getElementById('filterStatus').value;
  const filtered = items.filter(x=> (!fs || x.subject===fs) && (!fst || x.status===fst));

  const subjects = Array.from(new Set(items.map(x=>x.subject).filter(Boolean))).sort();
  const sel = document.getElementById('filterSubject');
  const current = sel.value;
  sel.innerHTML = '<option value="">å…¨éƒ¨ç§‘ç›®</option>' + subjects.map(s=> `<option ${s===current?'selected':''}>${s}</option>`).join('');

  document.getElementById('countOut').textContent = items.length;
  const today = todayStr();
  document.getElementById('dueOut').textContent = items.filter(x=> x.nextReview && x.nextReview <= today && !x.done).length;

  filtered.sort((a,b)=> (a.nextReview||'9999') < (b.nextReview||'9999') ? -1 : 1);

  const rows = filtered.map((it,i)=>{
    const tags = (it.tags||[]).map(t=> `<span class='tag'>#${t}</span>`).join(' ');
    return `<tr>
      <td style="border-radius:10px 0 0 10px">${i+1}</td>
      <td><div>${it.subject}</div><div class="muted">${it.topic}</div></td>
      <td>${it.errType}<br/><span class="muted">${it.level}</span></td>
      <td style="word-break:break-all">${it.qref||'-'}</td>
      <td style="word-break:break-all">${it.cause||'-'}</td>
      <td style="word-break:break-all">${it.solution||'-'}</td>
      <td>${tags||'-'}</td>
      <td>${nextReviewBadge(it)}</td>
      <td style="border-radius:0 10px 10px 0">
        <button class="btn" onclick="doReview(${it.id}, false)">å¤ä¹ å®Œæˆ</button>
        <div style="height:6px"></div>
        <button class="btn secondary" onclick="doReview(${it.id}, true)">æ ‡è®°æŒæ¡</button>
      </td>
    </tr>`;
  }).join("");

  document.getElementById('tableWrap').innerHTML = `<table>
    <thead><tr>
      <th>#</th><th>ç§‘ç›®/ä¸“é¢˜</th><th>ç±»å‹/éš¾åº¦</th><th>é¢˜å¹²/é“¾æ¥</th>
      <th>é”™å› åˆ†æ</th><th>æ­£ç¡®æ€è·¯</th><th>æ ‡ç­¾</th><th>ä¸‹æ¬¡å¤ä¹ </th><th>æ“ä½œ</th>
    </tr></thead>
    <tbody>${rows||'<tr><td colspan="9" style="text-align:center;background:#fafafa">æš‚æ— æ•°æ®ï¼Œå…ˆåœ¨ä¸Šæ–¹æ·»åŠ ä¸€æ¡å§</td></tr>'}</tbody>
  </table>`;
}

window.addEventListener('load', ()=>{
  const fd = document.getElementById('firstDate');
  const t = new Date(); const y=t.getFullYear(), m=('0'+(t.getMonth()+1)).slice(-2), d=('0'+t.getDate()).slice(-2);
  fd.value = `${y}-${m}-${d}`;
  render();
});

function downloadCSV(){
  const items = loadItems();
  const header = ["ç§‘ç›®","ä¸“é¢˜","é”™è¯¯ç±»å‹","éš¾åº¦","é¢˜å¹²/é“¾æ¥","é”™å› åˆ†æ","æ­£ç¡®æ€è·¯","æ ‡ç­¾","é¦–æ¬¡æ—¥æœŸ","ä¸‹æ¬¡å¤ä¹ ","çŠ¶æ€"];
  const lines = [header.join(",")];
  items.forEach(it=>{
    const row = [
      it.subject, it.topic, it.errType, it.level, it.qref||"", it.cause||"", it.solution||"",
      (it.tags||[]).join('|'), it.firstDate||"", it.nextReview||"", it.status||""
    ].map(x=> `"${(x||'').replace(/"/g,'""')}"`);
    lines.push(row.join(","));
  });
  const blob = new Blob([lines.join('\n')], {type:"text/csv;charset=utf-8;"});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = `å­¦æ•ˆå¼•æ“_é«˜é¢‘é”™é¢˜è¿½è¸ª_${new Date().toISOString().slice(0,10)}.csv`;
  a.click();
  URL.revokeObjectURL(a.href);
}
</script>
</body>
</html>
